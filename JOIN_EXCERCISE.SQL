

-- 급여가 2000 초과인 부서 정보, 사원 정보를 출력하세요
-- DEPT 테이블과 JOIN 해서, 부서 이름을 같이 출력

-- 이전 방식
SELECT D.DEPTNO,D.DNAME,E.EMPNO,E.ENAME,E.SAL 
FROM EMP E,DEPT D 
WHERE E.DEPTNO = D.DEPTNO AND E.SAL > 2000 
ORDER BY DEPTNO,SAL;

-- 표준 방식
SELECT DEPTNO,DNAME,EMPNO,ENAME,SAL 
FROM EMP E NATURAL JOIN DEPT D
WHERE E.SAL > 2000 
ORDER BY DEPTNO,SAL;

-- EX2. 부서별 평균 급여, 최대급여, 최소급여, 사원수
-- DEPT 테이블의 부서이름과 같이

-- 이전 방식
SELECT 
    D.DEPTNO, 
    D.DNAME, 
    FLOOR(AVG(SAL)) AVG_SAL, 
    MAX(SAL) MAX_SAL, 
    MIN(SAL) MIN_SAL, 
    COUNT(*) CNT 
FROM EMP E, DEPT D 
WHERE E.DEPTNO = D.DEPTNO 
GROUP BY D.DEPTNO, D.DNAME;

-- 표준 방식
SELECT D.DEPTNO, D.DNAME, FLOOR(AVG(SAL)) AVG_SAL, MAX(SAL) MAX_SAL, MIN(SAL) MIN_SAL, COUNT(*) CNT 
FROM EMP E JOIN DEPT D ON (D.DEPTNO = E.DEPTNO) 
GROUP BY D.DEPTNO, D.DNAME;

-- EX3. 모든 부서 정보와 사원 정보를
-- 부서번호, 사원 이름 순으로 정렬하여 출력해보세요.

-- 이전 방식
SELECT D.DEPTNO, D.DNAME, E.EMPNO, E.ENAME, E.JOB, E.SAL 
FROM EMP E, DEPT D
WHERE E.DEPTNO(+) = D.DEPTNO
ORDER BY D.DEPTNO,E.ENAME;

-- 표준 방식
SELECT D.DEPTNO, D.DNAME, E.EMPNO, E.ENAME, E.JOB, E.SAL 
FROM EMP E FULL OUTER JOIN DEPT D ON (E.DEPTNO = D.DEPTNO) 
ORDER BY D.DEPTNO,E.ENAME;



-- 모든 부서 정보(DEPTNO) 사원 정보(EMP) 급여등급정보(SALGRADE)
-- 직속상관정보(MGR) 부서번호, 사원번호 순으로 정렬해서 결과와 같이 출력해보세요.
SELECT D.DEPTNO, D.DNAME, E.EMPNO, E.ENAME, E.MGR, E.SAL, E.DEPTNO, S.LOSAL, S.HISAL, S.GRADE, E2.EMPNO AS MGR_EMPNO, E2.ENAME AS MGR_ENAME 
FROM DEPT D, EMP E, SALGRADE S, EMP E2
WHERE D.DEPTNO = E.DEPTNO(+)               -- 등가 JOIN
AND E.SAL BETWEEN S.LOSAL(+) AND S.HISAL(+)   -- 비등가 JOIN
AND E.MGR = E2.EMPNO(+)                    -- SELF JOIN
ORDER BY D.DEPTNO, E.EMPNO;

SELECT D.DEPTNO, D.DNAME, E.EMPNO, E.ENAME, E.MGR, E.SAL, E.DEPTNO, S.LOSAL, S.HISAL, S.GRADE, E2.EMPNO AS MGR_EMPNO, E2.ENAME AS MGR_ENAME 
FROM DEPT D LEFT OUTER JOIN EMP E ON(D.DEPTNO = E.DEPTNO) 
            LEFT OUTER JOIN SALGRADE S ON(E.SAL BETWEEN S.LOSAL AND S.HISAL)
            LEFT OUTER JOIN EMP E2 ON(E.MGR = E2.EMPNO)
ORDER BY D.DEPTNO, E.EMPNO;
